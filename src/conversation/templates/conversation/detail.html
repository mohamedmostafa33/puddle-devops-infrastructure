{% extends 'core/base.html' %}

{% block title %}Conversation{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-xl shadow-lg p-8">
        <div class="mb-8 pb-6 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                <svg class="w-8 h-8 mr-3 text-teal-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                </svg>
                Conversation
            </h1>
            <p class="text-gray-600 mt-2">About: <span class="font-semibold">{{ conversation.item.name }}</span></p>
        </div>

        <div class="space-y-4 mb-8 max-h-96 overflow-y-auto">
            {% for message in conversation.messages.all %}
                <div class="flex {% if message.created_by == request.user %}justify-end{% else %}justify-start{% endif %}">
                    <div class="max-w-md">
                        <div class="p-4 rounded-2xl {% if message.created_by == request.user %}bg-teal-500 text-white{% else %}bg-gray-200 text-gray-800{% endif %} shadow-md">
                            <div class="flex items-center mb-2">
                                <svg class="w-4 h-4 mr-2 {% if message.created_by == request.user %}text-teal-100{% else %}text-gray-600{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                                <p class="text-sm font-semibold">{{ message.created_by.username }}</p>
                            </div>
                            <p class="text-base leading-relaxed">{{ message.content }}</p>
                            <p class="text-xs mt-2 {% if message.created_by == request.user %}text-teal-100{% else %}text-gray-500{% endif %}">{{ message.created_at|date:"M d, Y - H:i" }}</p>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p class="text-center text-gray-500 py-8">No messages yet. Start the conversation!</p>
            {% endfor %}
        </div>

        <form method="post" action="." class="mt-6">
            {% csrf_token %}
            
            <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Your Message</label>
                {{ form.content }}
            </div>

            <button class="w-full py-4 px-8 text-lg bg-teal-500 hover:bg-teal-600 rounded-xl text-white font-semibold transition-colors duration-200 shadow-lg hover:shadow-xl flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                </svg>
                Send Message
            </button>
        </form>
    </div>
</div>
{% endblock %}